!function(a,b){"function"==typeof define&&define.amd?define(["d3"],b):"object"==typeof exports?(process.browser&&require("./d3.slider.css"),module.exports=b(require("d3"))):a.d3.slider=b(a.d3)}(this,function(a){return function(){"use strict";function v(b){b.each(function(){function v(b){"boolean"==typeof h&&(h=a.svg.axis().ticks(Math.round(u/100)).tickFormat(q).orient("horizontal"===g?"bottom":"right")),n=m.ticks?m.copy().range([0,u]):m.copy().rangePoints([0,u],.5),h.scale(n);var c=b.append("svg").classed("d3-slider-axis d3-slider-axis-"+h.orient(),!0).on("click",E),d=c.append("g");"horizontal"===g?(c.style("margin-left",-i+"px"),c.attr({width:u+2*i,height:i}),"top"===h.orient()?(c.style("top",-i+"px"),d.attr("transform","translate("+i+","+i+")")):d.attr("transform","translate("+i+",0)")):(c.style("top",-i+"px"),c.attr({width:i,height:u+2*i}),"left"===h.orient()?(c.style("left",-i+"px"),d.attr("transform","translate("+i+","+i+")")):d.attr("transform","translate(0,"+i+")")),d.call(h)}function A(){if("array"!=z(j)){var b=Math.max(0,Math.min(u,a.event.offsetX||a.event.layerX));w(m.invert?x(m.invert(b/u)):y(b/u))}}function B(){if("array"!=z(j)){var b=u-Math.max(0,Math.min(u,a.event.offsetY||a.event.layerY));w(m.invert?x(m.invert(b/u)):y(b/u))}}function C(){"handle-one"===a.event.sourceEvent.target.id?k=1:"handle-two"==a.event.sourceEvent.target.id&&(k=2);var b=Math.max(0,Math.min(u,a.event.x));w(m.invert?x(m.invert(b/u)):y(b/u))}function D(){"handle-one"===a.event.sourceEvent.target.id?k=1:"handle-two"==a.event.sourceEvent.target.id&&(k=2);var b=u-Math.max(0,Math.min(u,a.event.y));w(m.invert?x(m.invert(b/u)):y(b/u))}function E(){a.event.stopPropagation()}m||(m=a.scale.linear().domain([c,d])),j=j||m.domain()[0];var b=a.select(this).classed("d3-slider d3-slider-"+g,!0),e=a.behavior.drag();if(e.on("dragend",function(){o.slideend(a.event,j)}),"array"==z(j)&&2==j.length?(r=b.append("a").classed("d3-slider-handle",!0).attr("xlink:href","#").attr("id","handle-one").on("click",E).call(e),s=b.append("a").classed("d3-slider-handle",!0).attr("id","handle-two").attr("xlink:href","#").on("click",E).call(e)):r=b.append("a").classed("d3-slider-handle",!0).attr("xlink:href","#").attr("id","handle-one").on("click",E).call(e),"horizontal"===g){if(b.on("click",A),"array"==z(j)&&2==j.length){t=a.select(this).append("div").classed("d3-slider-range",!0),r.style("left",p(m(j[0]))),t.style("left",p(m(j[0]))),e.on("drag",C);var f=100-parseFloat(p(m(j[1])));s.style("left",p(m(j[1]))),t.style("right",f+"%"),e.on("drag",C)}else r.style("left",p(m(j))),e.on("drag",C);u=parseInt(b.style("width"),10)}else{if(b.on("click",B),e.on("drag",D),"array"==z(j)&&2==j.length){t=a.select(this).append("div").classed("d3-slider-range-vertical",!0),r.style("bottom",p(m(j[0]))),t.style("bottom",p(m(j[0]))),e.on("drag",D);var l=100-parseFloat(p(m(j[1])));s.style("bottom",p(m(j[1]))),t.style("top",l+"%"),e.on("drag",D)}else r.style("bottom",p(m(j))),e.on("drag",D);u=parseInt(b.style("height"),10)}h&&v(b)})}function w(b){var c="array"==z(j)&&2==j.length?j[k-1]:j,d=p(m(x(c))),e=p(m(x(b))),h="horizontal"===g?"left":"bottom";if(d!==e){if("array"==z(j)&&2==j.length?(j[k-1]=b,a.event&&o.slide(a.event,j)):a.event&&o.slide(a.event.sourceEvent||a.event,j=b),j[0]>=j[1])return;if(1===k)"array"==z(j)&&2==j.length&&("left"===h?t.style("left",e):t.style("bottom",e)),f?r.transition().styleTween(h,function(){return a.interpolate(d,e)}).duration("number"==typeof f?f:250):r.style(h,e);else{var i=100-parseFloat(e),l=100-parseFloat(e);"left"===h?t.style("right",i+"%"):t.style("top",l+"%"),f?s.transition().styleTween(h,function(){return a.interpolate(d,e)}).duration("number"==typeof f?f:250):s.style(h,e)}}}function x(a){if(a===m.domain()[0]||a===m.domain()[1])return a;var b=a;if(l)b=y(m(a));else{var c=(a-m.domain()[0])%e;b=a-c,2*Math.abs(c)>=e&&(b+=c>0?e:-e)}return b}function y(a){var b=m.ticks?m.ticks():m.domain(),c=b.map(function(b){return a-m(b)}),d=-1,e=0,f=m.ticks?m.range()[1]:m.rangeExtent()[1];do{d++,Math.abs(c[d])<f&&(f=Math.abs(c[d]),e=d)}while(c[d]>0&&d<c.length-1);return b[e]}function z(a){return{}.toString.call(a).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}var j,m,n,r,t,u,c=0,d=100,e=.01,f=!0,g="horizontal",h=!1,i=50,k=1,l=!1,o=a.dispatch("slide","slideend"),p=a.format(".2%"),q=a.format(".0"),s=null;return v.min=function(a){return arguments.length?(c=a,v):c},v.max=function(a){return arguments.length?(d=a,v):d},v.step=function(a){return arguments.length?(e=a,v):e},v.animate=function(a){return arguments.length?(f=a,v):f},v.orientation=function(a){return arguments.length?(g=a,v):g},v.axis=function(a){return arguments.length?(h=a,v):h},v.margin=function(a){return arguments.length?(i=a,v):i},v.value=function(a){return arguments.length?(j&&w(x(a)),j=a,v):j},v.snap=function(a){return arguments.length?(l=a,v):l},v.scale=function(a){return arguments.length?(m=a,v):m},a.rebind(v,o,"on"),v}});